================================================================================
今後の修正予定
================================================================================

作成日: 2026-02-04
最終更新: 2026-02-04

================================================================================
1. スローイン成功率の改善
================================================================================

【問題の概要】
スローインチェックモードではほぼ100%成功するが、試合モードではほとんど失敗する。

【原因分析】
チェックモードと試合モードの主な違い：

1. キャラクター数
   - チェックモード: 2人（スローワーとレシーバーのみ）
   - 試合モード: 10人（全選手）

2. 実行タイミング
   - チェックモード: 即時実行
   - 試合モード: 3秒間の待機後（throwInDelay = 3.0秒）

3. 他選手の干渉
   - チェックモード: なし
   - 試合モード: フォーメーション移動中に干渉可能

4. 位置制御
   - チェックモード: 固定位置
   - 試合モード: 物理演算で動く可能性あり

【試合モードで失敗する具体的な原因】

A) 3秒間の待機時間中の問題
   - 8人の他選手がフォーメーション位置に移動
   - ディフェンダーがスローワーとレシーバーの間に入る
   - レシーバーが他選手に押されて位置がずれる

B) フォーメーション配置の干渉
   - 関連コード: GameScene.ts:2169-2204
   - 他のオフェンス選手とディフェンス選手が同時に移動
   - パスの軌道上に選手が入る可能性

C) 衝突判定の複雑さ
   - 10人の選手間で衝突判定が発生
   - レシーバーがパスをキャッチする前に位置がずれる

【修正案】

案1: 待機時間中に他選手を固定する
   - THROW_IN_OTHER状態の選手の移動を禁止
   - ThrowInOtherAI.tsで移動を停止させる
   - 優先度: 高

案2: レシーバーの周囲にクリアスペースを確保する
   - フォーメーション配置時にレシーバー周囲を避ける
   - FormationUtils.tsの配置ロジックを修正
   - 優先度: 中

案3: ディフェンダーの配置をレシーバーから離す
   - スローイン時のディフェンスフォーメーションを調整
   - 最低距離を設定（例: 2m以上）
   - 優先度: 中

案4: 待機時間の短縮
   - throwInDelayを3.0秒から1.0秒に短縮
   - または、全選手が配置完了後に即時実行
   - 優先度: 低

案5: パス軌道の最適化
   - レシーバーへの直線経路に障害物がある場合、山なりパスの高さを調整
   - Ball.tsのpassWithArc()を修正
   - 優先度: 低

【関連ファイル】
- src/character-move/scenes/GameScene.ts (lines 2114-2228, 956-1028)
- src/character-move/controllers/check/ThrowInCheckController.ts (lines 343-376)
- src/character-move/entities/Ball.ts (lines 967-1159)
- src/character-move/controllers/CollisionHandler.ts (lines 78-168)
- src/character-move/ai/state/ThrowInOtherAI.ts
- src/character-move/config/FormationConfig.ts

【ステータス】
未着手

================================================================================
